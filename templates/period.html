{% extends "base.html" %}
{% block title %}{{ period_label }} – Financial Markets Analysis{% endblock %}
{% block nav %}
  <nav>
    {% if index_id %}
      <a href="{{ url_for('index') }}">Indexes</a>
      <a href="{{ url_for('index_periods', index_id=index_id) }}">{{ index_label }}</a>
    {% else %}
      <a href="{{ url_for('index') }}">All periods</a>
    {% endif %}
    {% for p in periods %}
      {% if index_id %}
        <a href="{{ url_for('index_period', index_id=index_id, period_id=p.id) }}" {% if p.id == period_id %}class="active"{% endif %}>{{ p.id }}</a>
      {% else %}
        <a href="{{ url_for('period', period_id=p.id) }}" {% if p.id == period_id %}class="active"{% endif %}>{{ p.id }}</a>
      {% endif %}
    {% endfor %}
  </nav>
{% endblock %}
{% block content %}
  <h2>{{ period_label }}</h2>

  {% if comparison %}
    <section class="comparison-section" style="margin-bottom: 2.5rem;">
      <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--muted);">{{ period_label }} — Performance comparison · Return (%) · $10K growth</h3>
      <div class="img-wrap">
        <img src="/heatmaps/{{ heatmap_base }}/{{ comparison }}" alt="{{ period_label }} — Performance comparison heatmap" loading="lazy">
      </div>
    </section>
  {% endif %}

  <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--muted);">{{ period_label }} — Monthly returns by symbol</h3>
  <div class="symbol-grid">
    {% if symbol_list and symbol_list|length > 0 %}
    {% for s in symbol_list %}
    <div class="symbol-card">
      <div class="img-wrap">
        <a href="{{ s.yahoo_url }}" target="_blank" rel="noopener" class="symbol-img-link" title="View {{ s.ticker }} on Yahoo Finance">
          <img src="/heatmaps/{{ heatmap_base }}/{{ s.filename }}" alt="{{ s.label }}" loading="lazy">
        </a>
      </div>
      <p class="symbol-label"><a href="{{ s.yahoo_url }}" target="_blank" rel="noopener" class="symbol-hyperlink">{{ s.label }}</a></p>
      <a href="{{ s.yahoo_url }}" target="_blank" rel="noopener" class="symbol-yahoo-link">View {{ s.ticker }} on Yahoo Finance ↗</a>
    </div>
    {% endfor %}
    {% else %}
    {% for name in symbols %}
      {% set ticker = name.replace('_monthly_returns_heatmap.png','').replace('.png','').split('_')[0]|upper %}
      {% set label = name.replace('_monthly_returns_heatmap.png','').replace('_', ' ') %}
    <div class="symbol-card">
      <div class="img-wrap">
        <a href="https://finance.yahoo.com/quote/{{ ticker }}" target="_blank" rel="noopener" class="symbol-img-link" title="View {{ ticker }} on Yahoo Finance">
          <img src="/heatmaps/{{ heatmap_base }}/{{ name }}" alt="{{ label }}" loading="lazy">
        </a>
      </div>
      <p class="symbol-label"><a href="https://finance.yahoo.com/quote/{{ ticker }}" target="_blank" rel="noopener" class="symbol-hyperlink">{{ label }}</a></p>
      <a href="https://finance.yahoo.com/quote/{{ ticker }}" target="_blank" rel="noopener" class="symbol-yahoo-link">View {{ ticker }} on Yahoo Finance ↗</a>
    </div>
    {% endfor %}
    {% endif %}
  </div>
  {% if not symbols and not comparison %}
    <p style="color: var(--muted);">No images in this period. <a href="{{ url_for('heatmaps_debug') }}" style="color: var(--accent);">Check heatmaps path</a></p>
  {% endif %}
{% endblock %}
{% block extra_css %}
  .comparison-section .img-wrap { max-width: 100%; }
  .symbol-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.25rem; }
  .symbol-img-link { display: block; line-height: 0; }
  .symbol-card .img-wrap { margin-bottom: 0.5rem; }
  .symbol-label { font-size: 0.9rem; font-weight: 600; margin: 0 0 0.25rem; word-break: break-word; }
  .symbol-hyperlink { color: #3b82f6; text-decoration: underline; }
  .symbol-hyperlink:hover { color: #60a5fa; }
  .symbol-yahoo-link { display: inline-block; color: #3b82f6; text-decoration: underline; font-size: 0.85rem; margin: 0; }
  .symbol-yahoo-link:hover { color: #60a5fa; }
{% endblock %}
